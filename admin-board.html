---
layout: default
title: "Admin – Board"
permalink: /admin-board/
sitemap: false
---
<meta name="page-login" content="required">
<meta name="page-role" content="admin">
<!-- Stop cached JS biting us on this page -->
<meta http-equiv="Cache-Control" content="no-store, max-age=0">
<meta http-equiv="Pragma" content="no-cache">
<meta http-equiv="Expires" content="0">

<script src="https://cdn.jsdelivr.net/npm/qrcodejs/qrcode.min.js"></script>
<script defer src="{{ '/js/QR.js' | relative_url }}"></script>

<!-- Supabase (must precede account.js) -->
<script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2.39.7/dist/umd/supabase.min.js"></script>

<!-- 2) Env + single initializer used by your JS -->
<script>
  window.SUPABASE_URL = "https://fvaahtqjusfniadwvoyw.supabase.co";
  window.SUPABASE_ANON_KEY = "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImZ2YWFodHFqdXNmbmlhZHd2b3l3Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTI4MDQ4ODgsImV4cCI6MjA2ODM4MDg4OH0.uvHGXXlijYIbuX_l85Ak7kdQDy3OaLmeplEEPlMqHo8";
  window.__ensureSB = async function () {
    if (window.sb) return window.sb;
    if (!window.supabase || !window.SUPABASE_URL || !window.SUPABASE_ANON_KEY) return null;
    window.sb = window.supabase.createClient(
      window.SUPABASE_URL,
      window.SUPABASE_ANON_KEY,
      { auth: { persistSession: true, autoRefreshToken: true, detectSessionInUrl: true } }
    );
    return window.sb;
  };
</script>

<!-- Page logic -->
<!-- IMPORTANT: add cache-busting query (Jekyll timestamp) -->
<script src="{{ '/js/account.js' | relative_url }}?v={{ site.time | date: '%s' }}" defer></script>
<link rel="stylesheet" href="/assets/css/kanban.css">

<section class="container py-4" data-aos="fade-up">
  <div class="d-flex align-items-center justify-content-between mb-3 flex-wrap gap-2">
    <h1 class="m-0 text-primary fw-bold">Admin Board</h1>
    <div class="d-flex align-items-center gap-2 flex-wrap">
      <span id="roleBadge" class="badge bg-dark">Checking…</span>
      <div class="btn-group" role="group" aria-label="Quick add">
        <button class="btn btn-outline-primary btn-sm" id="btnAddTask">+ Task</button>
        <button class="btn btn-outline-warning btn-sm" id="btnAddBug">+ Bug</button>
        <button class="btn btn-outline-success btn-sm" id="btnAddNote">+ Note</button>
      </div>
      <button id="btnAddCol" class="btn btn-outline-primary btn-sm">+ Column</button>

      <span id="lastSynced" class="badge text-bg-light">Last synced: —</span>
      <div class="btn-group ms-2" role="group" aria-label="Filter">
        <input type="radio" class="btn-check" name="kanFilter" id="fltActive" autocomplete="off" checked>
        <label class="btn btn-outline-secondary btn-sm" for="fltActive">Active</label>
        <input type="radio" class="btn-check" name="kanFilter" id="fltArchived" autocomplete="off">
        <label class="btn btn-outline-secondary btn-sm" for="fltArchived">Archived</label>
        <input type="radio" class="btn-check" name="kanFilter" id="fltTrash" autocomplete="off">
        <label class="btn btn-outline-secondary btn-sm" for="fltTrash">Trash</label>
      </div>

      <div class="input-group input-group-sm ms-2" style="max-width:220px">
        <span class="input-group-text"><i class="fa-solid fa-magnifying-glass"></i></span>
        <input id="kanSearch" type="search" class="form-control" placeholder="Search…">
      </div>

      <div class="btn-group ms-2" role="group" aria-label="Drafts">
        <button id="btnSync" class="btn btn-danger btn-sm btn-sync">
          Sync to Database <span id="syncCount" class="badge rounded-pill text-bg-light sync-count d-none">0</span>
        </button>
        <button id="btnDiscard" class="btn btn-outline-secondary btn-sm">Discard Drafts</button>
        <button id="btnReload" class="btn btn-outline-secondary btn-sm">Reload</button>
        <button id="btnUndo" class="btn btn-outline-secondary btn-sm" title="Undo last local change">Undo</button>
      </div>
    </div>
  </div>

  <div id="kanWrap" class="kan-wrap"></div>
  <div id="kanTip" class="mt-3">
    Add columns/cards freely. <strong>No writes happen until you press “Sync to Database”.</strong>
    You’ll be warned before leaving if unsynced changes exist.
  </div>
</section>

<div class="modal fade" id="conflictModal" tabindex="-1" aria-hidden="true">
  <div class="modal-dialog modal-dialog-centered"><div class="modal-content">
    <div class="modal-header">
      <h5 class="modal-title">Conflicts detected</h5>
      <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
    </div>
    <div class="modal-body">
      <p class="mb-2">Some items were modified by others since you loaded the board:</p>
      <ul id="conflictList" class="small"></ul>
      <p class="small text-muted mb-0">Choose an action below:</p>
    </div>
    <div class="modal-footer">
      <button type="button" class="btn btn-outline-secondary" data-bs-dismiss="modal">Cancel</button>
      <button type="button" id="btnSkipConflicts" class="btn btn-outline-primary">Skip conflicting ops</button>
      <button type="button" id="btnOverwriteConflicts" class="btn btn-danger">Overwrite with my changes</button>
    </div>
  </div></div>
</div>

<div class="d-grid gap-2 col-12 col-md-6 mx-auto my-3">
  <button id="btnToggleMembers" class="btn btn-primary btn-lg">
    Show Member Tools
  </button>
</div>


<div id="mbv_wrap" style="display:none">

  <!-- Member Viewer -->
  <section id="mbv" class="container my-4" data-aos="fade-up">
    <div class="d-flex align-items-center justify-content-between mb-2">
      <h2 class="h5 fw-semibold mb-0">Member Viewer</h2>
      <div class="input-group" style="max-width:520px">
        <span class="input-group-text"><i class="fa-solid fa-magnifying-glass"></i></span>
        <input id="mbv_q" class="form-control" placeholder="Search by name (any part) or PRC number…" autocomplete="off">
        <button id="mbv_clr" class="btn btn-outline-secondary" type="button">Clear</button>
      </div>
    </div>
    <div class="row g-3">
      <div class="col-12 col-lg-4">
        <div class="card shadow-sm">
          <div class="card-header bg-light fw-semibold">Results</div>
          <div class="list-group list-group-flush" id="mbv_list" style="max-height:420px;overflow:auto"></div>
        </div>
      </div>
      <div class="col-12 col-lg-8">
        <div id="mbv_card">
          <div id="exportArea">
            <div class="card shadow-sm digital-card mx-auto mb-3" style="max-width: 750px;">
              <div class="card-header text-center bg-light">
                <img src="{{ site.data.images.s-logo}}" alt="UAP MCC" class="card-header-logo mb-2" />
                <div class="card-header-title fw-semibold">UAP Manila Corinthian Chapter</div>
              </div>
              <div class="card-body p-4">
                <h2 id="cardName" class="fw-bold mb-1 text-center">Member Name</h2>
                <p class="text-center mb-3">
                  <span id="statusBadge" class="badge bg-secondary" style="font-size: 1.2rem;" aria-live="polite">Status</span>
                </p>
                <div class="row gx-2 gy-1 mb-3 small">
                  <div class="col-5 text-end fw-semibold">Batch:</div><div class="col-7" id="cardBatch"></div>
                  <div class="col-5 text-end fw-semibold">Company:</div>
                  <div class="col-7 d-flex align-items-center"><span id="cardCompany" class="sensitive-text flex-grow-1" data-shown="1">*</span><button type="button" class="toggle-sensitive-btn btn btn-sm border-0 bg-transparent text-body ms-2" aria-label="Toggle Company"><i class="fa-solid fa-eye-slash"></i></button></div>
                  <div class="col-5 text-end fw-semibold">Position:</div>
                  <div class="col-7 d-flex align-items-center"><span id="cardPosition" class="sensitive-text flex-grow-1" data-shown="1">*</span><button type="button" class="toggle-sensitive-btn btn btn-sm border-0 bg-transparent text-body ms-2" aria-label="Toggle Position"><i class="fa-solid fa-eye-slash"></i></button></div>
                </div>
                <hr />
                <div class="small">
                  <div class="d-flex align-items-center mb-2"><span class="fw-semibold me-1">PRC License:</span><span id="prcLicense" class="sensitive-text flex-grow-1" tabindex="0" aria-label="PRC license masked" data-shown="1">*</span><button type="button" class="toggle-sensitive-btn btn btn-sm border-0 bg-transparent text-body ms-2" aria-label="Toggle PRC"><i class="fa-solid fa-eye-slash"></i></button></div>
                  <div class="d-flex align-items-center mb-2"><span class="fw-semibold me-1">Email:</span><span id="email" class="sensitive-text flex-grow-1" tabindex="0" aria-label="Email masked" data-shown="1">*</span><button type="button" class="toggle-sensitive-btn btn btn-sm border-0 bg-transparent text-body ms-2" aria-label="Toggle Email"><i class="fa-solid fa-eye-slash"></i></button></div>
                  <div class="d-flex align-items-center"><span class="fw-semibold me-1">Contact No.:</span><span id="contactNo" class="sensitive-text flex-grow-1" tabindex="0" aria-label="Contact number masked" data-shown="1">*</span><button type="button" class="toggle-sensitive-btn btn btn-sm border-0 bg-transparent text-body ms-2" aria-label="Toggle Contact"><i class="fa-solid fa-eye-slash"></i></button></div>
                </div>
              </div>
              <div class="card-footer text-center py-3 bg-light"><p class="mb-0"><strong>Total Due:</strong> <span id="totalDue">₱0</span></p></div>
            </div>

            <div class="card shadow-lg mx-auto border-0 mb-3 rounded-4" style="max-width: 420px; background: #fdfdfd;">
              <div class="card-body d-flex flex-column align-items-center p-4 position-relative">
                <div id="qr-wrapper" style="position: relative;"><div id="qr-vcard"></div><img src="{{ site.data.images.s-logo }}" alt="UAP MCC Logo" style="position: absolute; top: 50%; left: 50%; width: 75px; height: 75px; transform: translate(-50%, -50%); border-radius: 10%;" /></div>
                <div class="text-primary fw-semibold fs-6 mt-3">Digital Business Card</div>
                <small class="text-muted">Scan to save contact info</small>
                <small class="text-muted d-block">Only visible fields are included in the QR.</small>
              </div>
            </div>

            <section class="container">
              <div class="d-flex align-items-center justify-content-between mb-2">
                <h2 class="h6 text-primary fw-semibold mb-0">Payment History</h2>
                <button id="paymentsToggleBtn" class="btn btn-sm btn-outline-secondary" type="button" data-bs-toggle="collapse" data-bs-target="#paymentsCollapse" aria-expanded="true" aria-controls="paymentsCollapse"><i class="fa-solid fa-angle-down rotate-icon"></i></button>
              </div>
              <div id="paymentsCollapse" class="collapse show">
                <div id="paymentsWrapper" class="d-flex justify-content-center">
                  <div class="scrollable-table-container">
                    <table id="paymentsTable" class="table table-sm align-middle text-center mb-0 payment-table">
                      <thead class="table-light"><tr><th class="sticky-col">Year</th></tr></thead>
                      <tbody class="group-chapter"><tr><th scope="row" class="sticky-col">Chapter Dues</th></tr><tr><th scope="row" class="sticky-col">Chapter Penalty</th></tr><tr><th scope="row" class="sticky-col">Payment Date</th></tr></tbody>
                      <tbody class="group-iapoa"><tr><th scope="row" class="sticky-col">IAPOA Dues</th></tr><tr><th scope="row" class="sticky-col">IAPOA Penalty</th></tr><tr><th scope="row" class="sticky-col">IAPOA Payment Date</th></tr></tbody>
                    </table>
                  </div>
                </div>
              </div>
            </section>
          </div>
        </div>
      </div>
    </div>
  </section>

  <!-- Admin Edit Panel -->
  <section id="mbv_editpanel" class="container my-3" data-aos="fade-up">
    <div class="card shadow-sm">
      <div class="card-header bg-light fw-semibold d-flex align-items-center justify-content-between">
        <span>Edit Selected Member</span>
        <small class="text-muted">Please double check before editing, this will directly edit the database</small>
      </div>
      <div class="card-body">
        <div class="row g-2 mb-2">
          <div class="col-12"><label class="form-label small mb-1">Surname</label>
            <input id="upd2Surname" class="form-control form-control-sm" autocomplete="off">
          </div>
          <div class="col-12"><label class="form-label small mb-1">Given Name</label>
            <input id="upd2Given" class="form-control form-control-sm" autocomplete="off">
          </div>
          <div class="col-12"><label class="form-label small mb-1">Middle Name</label>
            <input id="upd2Middle" class="form-control form-control-sm" autocomplete="off">
          </div>
        </div>

        <div class="col-12 col-md-3">
          <label class="form-label mb-1">PRC License</label>
          <input id="upd2PRC" class="form-control form-control-sm" inputmode="numeric" pattern="[0-9]*">
        </div>
        <div class="col-12 col-md-3">
          <label class="form-label mb-1">Batch</label>
          <input id="upd2Batch" class="form-control form-control-sm">
        </div>

        <div class="col-12">
          <label class="form-label mb-1">Address</label>
          <input id="upd2Address" class="form-control form-control-sm" autocomplete="street-address">
        </div>

        <div class="col-12 col-md-4">
          <label class="form-label mb-1">Birthday</label>
          <input id="upd2Birthday" type="date" class="form-control form-control-sm">
        </div>

        <div class="col-12 col-md-4">
          <label class="form-label mb-1">Contact No.</label>
          <input id="upd2Contact" class="form-control form-control-sm" placeholder="09xxxxxxxxx or +639xxxxxxxxx">
        </div>
        <div class="col-12 col-md-4">
          <label class="form-label mb-1">Email</label>
          <input id="upd2Email" type="email" class="form-control form-control-sm" autocomplete="email">
        </div>

        <div class="col-12 col-md-6">
          <label class="form-label mb-1">Company</label>
          <input id="upd2Company" class="form-control form-control-sm" autocomplete="organization">
        </div>
        <div class="col-12 col-md-6">
          <label class="form-label mb-1">Position</label>
          <input id="upd2Position" class="form-control form-control-sm" autocomplete="organization-title">
        </div>

        <div class="col-12 d-flex align-items-center gap-2 mt-2">
          <input id="chkResetPw" class="form-check-input" type="checkbox">
          <label for="chkResetPw" class="form-check-label">Reset their password?</label>
        </div>
      </div>
      <div class="card-footer d-flex justify-content-between">
        <small class="text-muted">Selected row: <span id="mbv_selid">—</span></small>
        <div class="btn-group">
          <button id="mbv_editbtn" class="btn btn-sm btn-primary">Edit &amp; Save</button>
          <button id="mbv_fillfromcard" class="btn btn-sm btn-outline-secondary">Load from Card</button>
        </div>
      </div>
    </div>
  </section>
</div>

<!-- IMPORTANT: cache-bust these two as well -->
<script src="{{ '/js/kanban.js' | relative_url }}?v={{ site.time | date: '%s' }}" defer></script>
<script src="{{ '/js/member_viewer.js' | relative_url }}?v={{ site.time | date: '%s' }}" defer></script>
<script src="{{ '/js/member_editor.js' | relative_url }}?v={{ site.time | date: '%s' }}" defer></script>

<!-- Toggle + first-show boot -->
<script>
  (function () {
    const btn = document.getElementById('btnToggleMembers');
    const sec = document.getElementById('mbv_wrap');
    if (!btn || !sec) return;

    const KEY = 'mbvVisible';

    function setState(show) {
      sec.style.display = show ? '' : 'none';
      btn.textContent = show ? 'Hide Member Tools' : 'Show Member Tools';
      try { localStorage.setItem(KEY, show ? '1' : '0'); } catch (_) {}

      if (show) {
        // ensure SB client exists
        if (typeof window.__ensureSB === 'function') { window.__ensureSB(); }
        // boot viewer bindings + list fill
        if (typeof window.__mbv_forceInit === 'function') window.__mbv_forceInit();

        // explicit first search (empty), plus retrigger input for debounce path
        setTimeout(() => {
          const q = document.getElementById('mbv_q');
          if (typeof window.__mbv_search === 'function') window.__mbv_search('');
          if (q) q.dispatchEvent(new Event('input', { bubbles: true }));
        }, 80);
      }
    }

    // restore last state
    const saved = (typeof localStorage !== 'undefined') ? localStorage.getItem(KEY) : null;
    setState(saved === '1'); // default hidden unless previously shown

    btn.addEventListener('click', () => setState(sec.style.display === 'none'));
  })();
</script>


